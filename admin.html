<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hackathon Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617, #020617 40%, #000 100%);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }
    .wrap {
      width: 100%;
      max-width: 1100px;
      padding: 20px 14px 40px;
    }
    h1 {
      margin: 0 0 4px;
      font-size: 1.7rem;
    }
    p.sub {
      margin: 0 0 18px;
      font-size: .9rem;
      color: #9ca3af;
    }
    .top-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    button {
      border: none;
      cursor: pointer;
      padding: 7px 14px;
      border-radius: 999px;
      font-size: .85rem;
      font-weight: 600;
      background: linear-gradient(135deg, #6366f1, #0ea5e9);
      color: white;
      box-shadow: 0 10px 24px rgba(59, 130, 246, .45);
      transition: transform .1s, box-shadow .1s;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(59, 130, 246, .55);
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.35);
      font-size: .75rem;
      color: #9ca3af;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px;
      margin-bottom: 14px;
    }
    .card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 14px;
      padding: 12px 14px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    .card-title {
      font-size: .9rem;
      margin-bottom: 4px;
      color: #cbd5f5;
    }
    .card-value {
      font-size: 1.4rem;
      font-weight: 600;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin: 8px 0 10px;
      border-bottom: 1px solid rgba(55, 65, 81, 0.9);
    }
    .tab {
      padding: 7px 14px;
      font-size: .85rem;
      cursor: pointer;
      border-radius: 999px 999px 0 0;
      border: 1px solid transparent;
      border-bottom: none;
      color: #9ca3af;
    }
    .tab.active {
      background: rgba(15, 23, 42, 0.98);
      border-color: rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
    }
    .panel {
      background: rgba(15, 23, 42, 0.98);
      border-radius: 0 0 16px 16px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 10px 10px 14px;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .8rem;
    }
    th, td {
      border-bottom: 1px solid rgba(55, 65, 81, 0.9);
      padding: 6px 6px;
      text-align: left;
    }
    th {
      font-size: .78rem;
      text-transform: uppercase;
      letter-spacing: .05em;
      color: #9ca3af;
    }
    tr:hover td {
      background: rgba(30, 64, 175, 0.25);
    }
    a {
      color: #38bdf8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .status {
      font-size: .8rem;
      margin-left: 8px;
    }
    .status.ok { color: #4ade80; }
    .status.err { color: #fb7185; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Hackathon Admin</h1>
    <p class="sub">View all registrations and submissions stored in MongoDB.</p>

    <div class="top-bar">
      <button id="refreshBtn">Refresh Data</button>
      <span id="status" class="status"></span>
      <span id="info" class="pill">Tip: keep this page open during the event.</span>
    </div>

    <div class="cards">
      <div class="card">
        <div class="card-title">Total Registrations</div>
        <div id="regCount" class="card-value">â€“</div>
      </div>
      <div class="card">
        <div class="card-title">Total Submissions</div>
        <div id="subCount" class="card-value">â€“</div>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="regs">Registrations</div>
      <div class="tab" data-tab="subs">Submissions</div>
    </div>

    <div class="panel" id="panel-regs">
      <table id="regTable">
        <thead>
          <tr>
            <th>Time</th>
            <th>Leader</th>
            <th>Email</th>
            <th>Phone</th>
            <th>College</th>
            <th>Team</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="panel" id="panel-subs" style="display:none">
      <table id="subTable">
        <thead>
          <tr>
            <th>Time</th>
            <th>Team</th>
            <th>Leader</th>
            <th>Email</th>
            <th>Project</th>
            <th>Code</th>
            <th>Demo</th>
            <th>Stack</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // ðŸ‘‡ Change this AFTER deployment to your Render/Railway URL
    const API_BASE = "http://localhost:4000";

    const statusEl = document.getElementById("status");
    const regBody = document.querySelector("#regTable tbody");
    const subBody = document.querySelector("#subTable tbody");
    const regCountEl = document.getElementById("regCount");
    const subCountEl = document.getElementById("subCount");

    async function loadData() {
      statusEl.textContent = "Loading...";
      statusEl.className = "status";

      try {
        const [regRes, subRes] = await Promise.all([
          fetch(`${API_BASE}/api/register`),
          fetch(`${API_BASE}/api/submit`)
        ]);
        const regJson = await regRes.json();
        const subJson = await subRes.json();

        if (!regJson.success || !subJson.success) {
          throw new Error("API error");
        }

        const regs = regJson.data || [];
        const subs = subJson.data || [];

        regCountEl.textContent = regs.length;
        subCountEl.textContent = subs.length;

        regBody.innerHTML = regs.map(r => `
          <tr>
            <td>${formatTime(r.createdAt)}</td>
            <td>${escapeHtml(r.fullName)}</td>
            <td>${escapeHtml(r.email)}</td>
            <td>${escapeHtml(r.phone)}</td>
            <td>${escapeHtml(r.college)}</td>
            <td>${escapeHtml(r.teamName || "-")}</td>
          </tr>
        `).join("");

        subBody.innerHTML = subs.map(s => `
          <tr>
            <td>${formatTime(s.createdAt)}</td>
            <td>${escapeHtml(s.teamName)}</td>
            <td>${escapeHtml(s.leaderName)}</td>
            <td>${escapeHtml(s.email)}</td>
            <td>${escapeHtml(s.projectTitle)}</td>
            <td>${s.codeLink ? `<a href="${escapeAttr(s.codeLink)}" target="_blank">Repo</a>` : "-"}</td>
            <td>${s.demoLink ? `<a href="${escapeAttr(s.demoLink)}" target="_blank">Demo</a>` : "-"}</td>
            <td>${escapeHtml(s.techStack || "-")}</td>
          </tr>
        `).join("");

        statusEl.textContent = "Loaded successfully";
        statusEl.classList.add("ok");
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Failed to load data";
        statusEl.classList.add("err");
      }
    }

    function formatTime(t) {
      if (!t) return "-";
      const d = new Date(t);
      return d.toLocaleString();
    }

    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function escapeAttr(str) {
      return escapeHtml(str).replace(/"/g, "&quot;");
    }

    document.getElementById("refreshBtn").addEventListener("click", loadData);

    // tabs
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        const which = tab.dataset.tab;
        document.getElementById("panel-regs").style.display = which === "regs" ? "block" : "none";
        document.getElementById("panel-subs").style.display = which === "subs" ? "block" : "none";
      });
    });

    // initial load
    loadData();
  </script>
</body>
</html>
